<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to PNG/JPG è½‰æ›å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f6f9; display: flex; flex-direction: column; align-items: center; padding: 40px; margin: 0; }
        .container { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); width: 100%; max-width: 950px; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 35px; font-weight: 800; }
        
        /* æ‹–æ›³å€åŸŸ */
        #drop-zone { 
            border: 3px dashed #3498db; 
            border-radius: 15px; 
            padding: 50px; 
            text-align: center; 
            color: #3498db; 
            cursor: pointer; 
            transition: all 0.3s; 
            background: #fdfdfd; 
            margin-bottom: 30px; 
        }
        #drop-zone:hover { background: #f0f7ff; border-color: #2980b9; }
        #drop-zone.highlight { background: #e8f4fd; border-color: #1a5276; }

        /* æ§åˆ¶åˆ— */
        .controls { 
            display: flex; 
            flex-wrap: wrap;
            justify-content: center; 
            gap: 15px; 
            align-items: center; 
            margin-bottom: 30px; 
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        select { padding: 12px 15px; border-radius: 8px; border: 1px solid #ced4da; font-size: 16px; min-width: 200px; outline: none; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { padding: 12px 25px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; color: white; }
        .btn-png { background-color: #10b981; } 
        .btn-png:hover { background-color: #059669; transform: translateY(-2px); }
        .btn-jpg { background-color: #3b82f6; } 
        .btn-jpg:hover { background-color: #2563eb; transform: translateY(-2px); }
        .btn:active { transform: translateY(0); }

        /* é è¦½å€åŸŸ */
        #preview-container { width: 100%; margin-top: 20px; }
        .page-item { background: #fff; border: 1px solid #e9ecef; padding: 20px; margin-bottom: 30px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .page-item img { max-width: 100%; border-radius: 4px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin: 15px 0; }
        .save-btn { display: inline-block; padding: 10px 20px; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; margin-top: 10px; font-weight: 600; }
        .save-png { background: #059669; }
        .save-jpg { background: #2563eb; }

        .loading-overlay { text-align: center; color: #666; padding: 20px; display: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>PDF to PNG/JPG è½‰æ›å™¨</h1>
        
        <div id="drop-zone">
            <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“„</div>
            <strong>å°‡ PDF æª”æ¡ˆæ‹–æ›³è‡³æ­¤</strong><br>æˆ–é»æ“Šæ­¤è™•é¸å–æª”æ¡ˆ
        </div>
        <input type="file" id="file-input" accept="application/pdf" style="display:none">

        <div class="controls">
            <label style="font-weight: bold;">è§£æåº¦è¨­å®šï¼š</label>
            <select id="scale-select">
                <option value="1">æ™®é€š (è¢å¹•çœ‹ç¨¿)</option>
                <option value="2">æ¸…æ™° (ä¸€èˆ¬è¾¦å…¬)</option>
                <option value="3">æ¥µè‡´ (300 DPI é«˜æ¸…)</option>
                <option value="5" selected>å°åˆ·ç­‰ç´š (è¶…é«˜è§£æåº¦)</option> 
            </select>
            
            <button id="convert-png-btn" class="btn btn-png">é–‹å§‹è½‰æ›ç‚º PNG</button>
            <button id="convert-jpg-btn" class="btn btn-jpg">é–‹å§‹è½‰æ›ç‚º JPG</button>
        </div>

        <div id="loading" class="loading-overlay">ğŸš€ æ­£åœ¨é€²è¡Œé«˜å“è³ªæ¸²æŸ“ï¼Œè«‹ç¨å€™...</div>
        <div id="preview-container"></div>
    </div>

    <script>
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const previewContainer = document.getElementById('preview-container');
        const loading = document.getElementById('loading');
        let selectedFile = null;

        // æ‹–æ›³æ””æˆª
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(n => {
            dropZone.addEventListener(n, e => { e.preventDefault(); e.stopPropagation(); });
        });

        dropZone.addEventListener('dragover', () => dropZone.classList.add('highlight'));
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('highlight'));

        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = e => { if(e.target.files[0]) loadFile(e.target.files[0]); };
        
        dropZone.addEventListener('drop', e => {
            dropZone.classList.remove('highlight');
            const file = e.dataTransfer.files[0];
            if (file && file.type === "application/pdf") loadFile(file);
            else alert("è«‹ä¸Šå‚³ PDF æª”æ¡ˆï¼");
        });

        function loadFile(file) {
            selectedFile = file;
            dropZone.innerHTML = `<div style="font-size: 40px; margin-bottom: 10px;">âœ…</div><strong style="color:#2ecc71">å·²è®€å–ï¼š${file.name}</strong><br>è«‹é¸æ“‡ä¸‹æ–¹æ ¼å¼é–‹å§‹è½‰æ›`;
        }

        // è½‰æ›é‚è¼¯
        async function startConversion(format) {
            if (!selectedFile) return alert("è«‹å…ˆé¸å– PDF æª”æ¡ˆå–”ï¼");
            
            previewContainer.innerHTML = "";
            loading.style.display = "block";
            
            const scale = parseFloat(document.getElementById('scale-select').value);
            const arrayBuffer = await selectedFile.arrayBuffer();
            
            try {
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: scale });

                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({ canvasContext: context, viewport: viewport }).promise;

                    // æ ¹æ“šé¸æ“‡çš„æ ¼å¼è¼¸å‡º
                    let imgData, ext, btnClass;
                    if (format === 'png') {
                        imgData = canvas.toDataURL('image/png');
                        ext = 'png';
                        btnClass = 'save-png';
                    } else {
                        imgData = canvas.toDataURL('image/jpeg', 1.0); // JPG æœ€é«˜å“è³ª 1.0
                        ext = 'jpg';
                        btnClass = 'save-jpg';
                    }
                    
                    const item = document.createElement('div');
                    item.className = 'page-item';
                    item.innerHTML = `
                        <p><strong>ç¬¬ ${i} é  / å…± ${pdf.numPages} é </strong></p>
                        <img src="${imgData}">
                        <br>
                        <a href="${imgData}" download="page-${i}.${ext}" class="save-btn ${btnClass}">å„²å­˜æ­¤é  ${ext.toUpperCase()}</a>
                    `;
                    previewContainer.appendChild(item);
                }
            } catch (err) {
                alert("éŒ¯èª¤ï¼š" + err.message);
            } finally {
                loading.style.display = "none";
            }
        }

        document.getElementById('convert-png-btn').onclick = () => startConversion('png');
        document.getElementById('convert-jpg-btn').onclick = () => startConversion('jpg');
    </script>
</body>
</html>